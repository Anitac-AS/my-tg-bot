<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Shu's MyMind</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "Segoe UI", 
                   'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeInDown 0.6s ease;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 36px;
      font-weight: 700;
      color: #fff;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .subtitle {
      font-size: 16px;
      color: rgba(255,255,255,0.9);
      font-weight: 400;
    }

    /* Search Bar */
    .search-wrapper {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 32px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      animation: fadeInUp 0.6s ease;
    }

    .search-bar {
      display: flex;
      gap: 12px;
    }

    .search-input-wrapper {
      flex: 1;
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      pointer-events: none;
      z-index: 1;
    }

    .search-bar input {
      width: 100%;
      padding: 14px 20px 14px 48px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      font-size: 15px;
      transition: all 0.3s ease;
      background: #fff;
    }

    .search-bar input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .search-bar button {
      padding: 14px 28px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      white-space: nowrap;
    }

    .search-bar button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .search-bar button:active:not(:disabled) {
      transform: translateY(0);
    }

    .search-bar button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Status Bar - ç§»åˆ°å³ä¸‹è§’ */
    .status-bar {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1000;
    }

    #status {
      font-size: 13px;
      color: rgba(255,255,255,0.95);
      font-weight: 500;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      padding: 10px 16px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }

    #status:hover {
      background: rgba(0,0,0,0.7);
    }

    .empty {
      text-align: center;
      font-size: 15px;
      color: rgba(255,255,255,0.8);
      margin-top: 60px;
      animation: fadeIn 0.6s ease;
    }

    /* Cards Grid */
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 20px;
      animation: fadeIn 0.8s ease;
      padding-bottom: 80px; /* ç‚ºåº•éƒ¨ç‹€æ…‹åˆ—ç•™ç©ºé–“ */
    }

    .card {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: all 0.3s ease;
      border: 1px solid rgba(255,255,255,0.3);
      animation: cardFadeIn 0.5s ease backwards;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }

    .card-title {
      font-weight: 700;
      font-size: 18px;
      color: #1f2937;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-summary {
      font-size: 14px;
      color: #4b5563;
      line-height: 1.6;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .card-tags span {
      display: inline-flex;
      align-items: center;
      background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%);
      color: #5b21b6;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .card-tags span:hover {
      transform: scale(1.05);
      background: linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%);
    }

    .card-meta {
      font-size: 12px;
      color: #9ca3af;
      padding-top: 8px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .meta-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .card-raw {
      font-size: 13px;
      color: #6b7280;
      white-space: pre-wrap;
      background: #f9fafb;
      border-radius: 8px;
      padding: 12px;
      margin-top: 4px;
      border-left: 3px solid #667eea;
      max-height: 120px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .card-raw::-webkit-scrollbar {
      width: 6px;
    }

    .card-raw::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .card-raw::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    .card-raw::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* Animations */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes cardFadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px 16px;
      }

      h1 {
        font-size: 28px;
      }

      .subtitle {
        font-size: 14px;
      }

      .search-wrapper {
        padding: 20px;
      }

      .search-bar {
        flex-direction: column;
      }

      .search-bar button {
        width: 100%;
        padding: 14px 20px;
      }

      /* æ‰‹æ©Ÿç‰ˆç§»é™¤æœå°‹åœ–ç¤ºï¼Œé¿å…é‡ç–Š */
      .search-icon {
        display: none;
      }

      .search-bar input {
        padding: 14px 20px;
      }

      .cards {
        grid-template-columns: 1fr;
        padding-bottom: 100px;
      }

      .status-bar {
        bottom: 16px;
        right: 16px;
        left: 16px;
      }

      #status {
        text-align: center;
        display: block;
        font-size: 12px;
        padding: 8px 12px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 24px;
      }

      .search-wrapper {
        padding: 16px;
      }

      .card {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>â­ Shu's MyMind</h1>
      <div class="subtitle">å¡«å……ã€æ­¸ç´ã€å£¯å¤§ã€ä½¿ç”¨</div>
    </div>

    <div class="search-wrapper">
      <div class="search-bar">
        <div class="search-input-wrapper">
          <div class="search-icon">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <input id="searchInput" type="text" placeholder="æœå°‹æ¨™é¡Œã€æ‘˜è¦æˆ–å…§å®¹..." />
        </div>
        <button id="searchBtn">
          <span class="btn-text">æœå°‹</span>
        </button>
      </div>
    </div>

    <div id="cards" class="cards"></div>
  </div>

  <!-- ç‹€æ…‹åˆ—ç§»åˆ°å³ä¸‹è§’ -->
  <div class="status-bar">
    <div id="status"></div>
  </div>

  <script>
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const cardsEl = document.getElementById("cards");
    const statusEl = document.getElementById("status");

    async function loadNotes(q = "") {
      searchBtn.disabled = true;
      searchBtn.innerHTML = '<span class="spinner"></span>';
      statusEl.textContent = q ? `æœå°‹ã€Œ${q}ã€ä¸­...` : "è¼‰å…¥ä¸­...";
      statusEl.style.display = 'block';
      cardsEl.innerHTML = "";

      const params = q ? `?q=${encodeURIComponent(q)}` : "";
      
      try {
        const res = await fetch(`/api/notes${params}`);
        if (!res.ok) {
          statusEl.textContent = "âŒ è®€å–å¤±æ•—";
          searchBtn.innerHTML = '<span class="btn-text">æœå°‹</span>';
          searchBtn.disabled = false;
          return;
        }
        const json = await res.json();
        const data = json.data || [];

        if (!data.length) {
          statusEl.textContent = q ? `ğŸ” ç„¡ç¬¦åˆçµæœ` : "ğŸ“­ æš«ç„¡è¨˜éŒ„";
          cardsEl.innerHTML = '<div class="empty">è©¦è‘—æ–°å¢ä¸€äº›å°è©±è¨˜éŒ„å§ï¼</div>';
          searchBtn.innerHTML = '<span class="btn-text">æœå°‹</span>';
          searchBtn.disabled = false;
          return;
        }

        statusEl.textContent = `å…± ${data.length} ç­†`;
        cardsEl.innerHTML = "";

        data.forEach((row, index) => {
          const card = document.createElement("div");
          card.className = "card";
          card.style.animationDelay = `${index * 0.05}s`;

          const title = document.createElement("div");
          title.className = "card-title";
          title.textContent = row.title || "ğŸ“ ç„¡æ¨™é¡Œè¨˜éŒ„";

          const summary = document.createElement("div");
          summary.className = "card-summary";
          summary.textContent = row.summary || "æš«ç„¡æ‘˜è¦å…§å®¹";

          const tagsDiv = document.createElement("div");
          tagsDiv.className = "card-tags";
          const tags = Array.isArray(row.tags)
            ? row.tags
            : (row.tags && typeof row.tags === "object" && row.tags.length ? row.tags : []);
          if (tags && tags.length) {
            tags.forEach(t => {
              const span = document.createElement("span");
              span.textContent = `#${t}`;
              tagsDiv.appendChild(span);
            });
          }

          const meta = document.createElement("div");
          meta.className = "card-meta";
          const created = row.created_at
            ? new Date(row.created_at).toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              })
            : "";
          meta.innerHTML = `
            <span class="meta-item">ğŸ’¬ ${row.tg_chat_id ?? 'N/A'}</span>
            <span class="meta-item">ğŸ‘¤ ${row.tg_user_id ?? 'N/A'}</span>
            <span class="meta-item">ğŸ• ${created}</span>
          `;

          const raw = document.createElement("div");
          raw.className = "card-raw";
          raw.textContent = row.raw_text || "ç„¡åŸå§‹å…§å®¹";

          card.appendChild(title);
          card.appendChild(summary);
          if (tagsDiv.childNodes.length) card.appendChild(tagsDiv);
          card.appendChild(meta);
          card.appendChild(raw);

          cardsEl.appendChild(card);
        });
      } catch (error) {
        statusEl.textContent = "âŒ è¼‰å…¥éŒ¯èª¤";
        cardsEl.innerHTML = '<div class="empty">ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š</div>';
      }

      searchBtn.innerHTML = '<span class="btn-text">æœå°‹</span>';
      searchBtn.disabled = false;
    }

    // åˆæ¬¡è¼‰å…¥
    loadNotes();

    searchBtn.addEventListener("click", () => {
      loadNotes(searchInput.value.trim());
    });

    // Enter ç›´æ¥æœå°‹
    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        loadNotes(searchInput.value.trim());
      }
    });
  </script>
</body>
</html>
